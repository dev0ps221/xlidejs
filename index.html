<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="xlide.css">
    <title>Slides</title>
</head>
<body>
    <style>
    </style>
    <section id='slider' class='xlide bgred reverser-rotate' >
        <div class="wrapper">
            <div class="xlide-item">
                <img src="slide1.avif" alt="">
                <div class="data">
                    <div class="title">
                        okok
                    </div>
                </div>
            </div>
            <div class="xlide-item">
                <img src="slide2.avif" alt="">
            </div>
            <div class="xlide-item">
                <img src="slide3.avif" alt="">
            </div>
            <div class="xlide-item">
                <img src="slide1.avif" alt="">
            </div>
            <div class="xlide-item">
                <img src="slide2.avif" alt="">
            </div>
        </div>
        <div class="controlbar">
            <div class="before"><</div>
            <div class="legends">
                <div class="legend">
                    <img src="slide1.avif" alt="">
                </div>
                <div class="legend">
                    <img src="slide2.avif" alt="">
                </div>
                <div class="legend">
                    <img src="slide3.avif" alt="">
                </div>
                <div class="legend">
                    <img src="slide1.avif" alt="">
                </div>
                <div class="legend">
                    <img src="slide2.avif" alt="">
                </div>
            </div>
            <div class="after">></div>
        </div>
    </section>
    <script>

        function init_xlide_controls(slider){
            slider.querySelectorAll(
                '.before'
            ).forEach(
                before=>{
                    before.addEventListener('click',e=>{
                        const slidenumber = parseInt(getComputedStyle(slider).getPropertyValue('--slide-position'))
                        if(slidenumber > 0){
                            setSlideVar(slider,'--slide-position',slidenumber-1)
                            disableLegends(slider)
                            enableLegend(slider,slidenumber-1)
                            slideOut(slider,slidenumber)
                            slideIn(slider,slidenumber-1)
                        
                        }
                    })
                }
            )
            slider.querySelectorAll(
                '.after'
            ).forEach(
                after=>{
                    after.addEventListener('click',e=>{
                        const slidenumber = parseInt(getComputedStyle(slider).getPropertyValue('--slide-position'))
                        if(slidenumber+1 < slider.querySelectorAll('.slide').length){
                            setSlideVar(slider,'--slide-position',slidenumber+1)
                            disableLegends(slider)
                            enableLegend(slider,slidenumber+1)
                            slideOut(slider,slidenumber)
                            slideIn(slider,slidenumber+1)
                        }
                    })
                }
            )

            slider.querySelectorAll(
                '.legend'
            ).forEach(
                (elem,idx)=>{
                    elem.addEventListener(
                        'click',e=>{
                            setSlideVar(slider,'--slide-position',idx)
                            disableLegends(slider)
                            enableLegend(slider,idx)
                            slideOut(slider,idx)
                            slideIn(slider,idx)
                        }
                    )
                    if(idx==0){
                        elem.click()
                    }
                }
            )

            slider.addEventListener(
                'animationend',e=>{
                    justSlide(slider)
                }
            )
            disableLegends(slider)
            enableLegend(slider,0)
        }
        function disableLegends(slider){
            slider.querySelectorAll(
                '.legend'
            ).forEach(
                (elem,idx)=>{
                    elem.classList.remove('active')
                }
            )
        }
        function slidesOut(slider){
            slider.querySelectorAll('.slide').forEach(
                slide=>{
                    slide.classList.remove('in')
                    slide.classList.add('out')
                }
            )
        }
        function slidesIn(slider){
            slider.querySelectorAll('.slide').forEach(
                slide=>{
                    slide.classList.remove('out')
                    slide.classList.add('in')
                }
            )
        }
        function slideIn(slider,idx){
            slider.querySelectorAll('.slide').forEach(
                (slide,i)=>{
                    if(i == idx){
                        slide.classList.remove('out')
                        slide.classList.add('in')
                    }
                }
            )
        }
        function slideOut(slider,idx){
            slider.querySelectorAll('.slide').forEach(
                (slide,i)=>{
                    if(i == idx){
                        slide.classList.remove('in')
                        slide.classList.add('out')
                    }
                }
            )
        }
        function justSlide(slider){
            slider.querySelectorAll('.slide').forEach(
                (slide,i)=>{
                    slide.classList.remove('in')
                    slide.classList.remove('out')
                
                }   
            )
        }
        function setSlideVar(slide,key,value){
            slider.style.setProperty(key,value)
        }
        function enableLegend(slider,idx){

            slider.querySelectorAll(
                '.legend'
            ).forEach(
                (elem,x)=>{
                    if(x == idx){
                        elem.classList.add('active')
                    }
                }
            )
        }
        init_xlide_controls(slider)
    </script>
</body>
</html>